{% extends 'Base.html' %}
{% load static %}

{% block title %}Lista de pendientes{% endblock %}

{% block content %}
<div class="flex justify-center items-start">
    {% include 'Panel.html' %}

    <!-- Bloque principal -->
    <div class="flex justify-center w-full p-4 items-start">
        <div class="flex justify-center">

            <!-- Contenedor de lista -->
            <div class="border border-neutral-600 border-r-0 bg-neutral-700 rounded-tl-md rounded-bl-md md:w-[550px] flex flex-col">

                <!-- Encabezado -->
                <div class="flex-shrink-0 p-6 pb-4">
                    <div class="flex justify-between items-center">
                        <div class="flex justify-center items-center">
                            <h1 class="font-bold text-lg">
                                {{ lista.titulo }} 
                            </h1>
                        </div>

                        <div class="flex items-center space-x-2">
                            <h2>(
                                <span id="cant_tareas_pendientes">{{ cant_tareas_pendientes }}</span> /
                                <span id="tareas-totales">{{ tareas|length }}</span>
                            )</h2>

                            {% if tareas %}
                                <button type="button" id="btn-limpiar-lista"
                                        data-url="{% url 'eliminar_todas_las_tareas' pk_lista=lista.pk %}"
                                        class="hover:cursor-pointer"
                                        title="Limpiar lista">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                         viewBox="0 0 24 24" stroke-width="1.5"
                                         stroke="currentColor" class="w-5 h-5 mt-1">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
                                    </svg>
                                </button>
                            {% endif %}
                        </div>
                    </div>
                    <hr class="my-2 border-neutral-600">
                </div>

                <!-- Contenedor lista de tareas (altura fija) -->
                <div class="h-[400px] px-6 mb-4">
                    {% if tareas %}
                        <ul class="space-y-2">
                            {% for tarea in tareas %}
                                <li class="flex justify-between items-center">
                                    <label class="flex items-center flex-grow">
                                        <input type="checkbox"
                                               name="tarea"
                                               class="tarea-checkbox mr-3"
                                               data-tarea-id="{{ tarea.pk }}"
                                               {% if tarea.completada %}checked{% endif %}>
                                        <span {% if tarea.completada %}class="line-through text-gray-400"{% endif %}>
                                            {{ tarea.descripcion }}
                                        </span>
                                    </label>
                                    <a href="{% url 'eliminar_tarea' pk_lista=lista.pk pk_tarea=tarea.pk %}">
                                        <img src="{% static 'img/icono-basura.svg' %}" alt="Eliminar" class="w-5 h-5">
                                    </a>
                                </li>
                                <hr class="border-neutral-600">
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-center text-gray-300 mt-2">¡No hay tareas en esta lista!</p>
                    {% endif %}
                </div>

            </div>

            <!-- Formulario -->
            <div>
               <form method="POST" action="{% url 'mostrarLista' pk=lista.pk %}" 
                     class="border border-neutral-600 bg-neutral-700 h-full rounded-tr-md rounded-br-md flex-shrink-0 p-3 flex flex-col">
                  {% csrf_token %}

                  <div class="flex space-x-2 mb-2 items-center">
                        <div class="flex-grow">{{ form.descripcion }}</div>
                        <button type="submit" title="Agregar tarea"
                              class="bg-indigo-700 hover:bg-indigo-600 text-white font-bold rounded-full w-8 h-8">
                           +
                        </button>
                  </div>

                  <!-- Mensaje de error -->
                  <span class="text-sm text-red-500 block min-h-[20px] mb-2">
                        {% if error_message %} 
                           {{ error_message }}
                        {% endif %}
                  </span>

                  <span class="text-sm text-right p-1 italic mt-auto text-neutral-400">
                     Creada el {{ lista.fechaCreacion|date:"d M, Y" }}
                  </span>
               </form>
            </div>

        </div>
    </div>
</div>

<!-- Modal confirmación eliminar todas las tareas -->
<div id="confirmacion-limpiar-modal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-neutral-800 p-6 rounded-lg shadow-xl w-80">
        <h3 class="text-xl font-bold mb-4">Confirmar limpieza</h3>
        <p class="mb-6">¿Estás seguro de que deseas eliminar <span class="font-bold">todas</span> las tareas de esta lista?</p>
        <div class="flex justify-end space-x-3">
            <button id="btn-cancelar"
                    class="px-4 py-2 text-sm rounded bg-gray-600 hover:bg-gray-500">
                Cancelar
            </button>
            <button id="btn-confirmar-limpieza"
                    class="px-4 py-2 text-sm rounded bg-red-700 hover:bg-red-600 font-bold">
                Eliminar todo
            </button>
        </div>
    </div>
</div>

<script src="{% static 'js/lista-pendientes/eliminar-todas-las-tareas.js' %}"></script>
{% endblock %}


